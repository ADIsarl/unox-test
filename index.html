<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UNOX Voice Assistant</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; text-align: center; padding: 20px; background: #121212; color: white; }
        .card { background: #1e1e1e; padding: 20px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); max-width: 450px; margin: auto; border: 1px solid #333; }
        #micBtn { width: 90px; height: 90px; border-radius: 50%; border: none; background: #007bff; color: white; font-size: 35px; cursor: pointer; transition: 0.3s; margin: 20px 0; }
        .recording { background: #ff4757 !important; transform: scale(1.1); box-shadow: 0 0 20px #ff4757; }
        #helpBtn { background: none; border: 1px solid #555; color: #aaa; padding: 5px 15px; border-radius: 20px; cursor: pointer; font-size: 13px; margin-bottom: 10px; }
        #helpContent { display: none; background: #252525; padding: 15px; border-radius: 10px; text-align: left; font-size: 13px; margin-top: 10px; color: #ddd; line-height: 1.5; }
        #confirmBox { display: none; margin-top: 20px; background: #2d2d2d; padding: 15px; border-radius: 12px; border: 1px dashed #555; }
        .btn-send { background: #2ed573; color: white; padding: 12px 25px; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; width: 100%; margin-top: 10px; }
        .preview { text-align: left; font-size: 14px; margin-bottom: 10px; }
        .highlight { color: #1e90ff; font-weight: bold; }
        .status { font-style: italic; color: #888; font-size: 14px; }
    </style>
</head>
<body>

    <div class="card">
        <button id="helpBtn">‚ùì Aide : Mots-cl√©s</button>
        <div id="helpContent">
            <strong>Exemple :</strong> "Devis pour client Martin √† Lyon, four Cheftop 10 niveaux gaz avec hotte."
        </div>

        <h2>Assistant UNOX</h2>
        <button id="micBtn">üéôÔ∏è</button>
        <div id="status" class="status">Appuyez pour parler</div>

        <div id="confirmBox">
            <div class="preview" id="previewText"></div>
            <button class="btn-send" id="sendBtn">ENVOYER ‚úÖ</button>
        </div>
    </div>

    <script>
        const webHookUrl = "https://hook.eu2.make.com/dkhjvgph0ma9v39b9vputryap8k2yqh5"; 
        let currentData = null;

        const types = ["DEVIS", "COMMANDE", "FACTURE"];
        const gammes = ["CHEFTOP", "BAKERTOP", "SPEED", "BAKERLUX", "CHEFLUX", "LINEMISS", "LINEMICRO", "EVEREO"];
        const energies = ["GAZ", "ELECTRIQUE", "√âLECTRIQUE"];
        const tensions = ["TRI", "TRIPHAS√â", "MONO", "MONOPHAS√â"];
        const ferrages = ["DROITE", "GAUCHE"];
        const optionsList = ["LAVAGE", "SONDE", "HOTTE", "OSMOSEUR"];

        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const synth = window.speechSynthesis;

        document.getElementById('helpBtn').onclick = () => {
            const content = document.getElementById('helpContent');
            content.style.display = content.style.display === 'block' ? 'none' : 'block';
        };

        if (SpeechRecognition) {
            const recognition = new SpeechRecognition();
            recognition.lang = 'fr-FR';

            document.getElementById('micBtn').onclick = () => {
                recognition.start();
                document.getElementById('micBtn').classList.add('recording');
                document.getElementById('status').innerText = "√âcoute...";
                document.getElementById('confirmBox').style.display = 'none';
            };

            recognition.onresult = (event) => {
                const phrase = event.results[0][0].transcript.toUpperCase();
                document.getElementById('micBtn').classList.remove('recording');
                
                currentData = {
                    type: types.find(t => phrase.includes(t)) || "DEVIS",
                    client: (phrase.match(/CLIENT ([\w√Ä-√ø]+)/) || [])[1] || "INCONNU",
                    ville: (phrase.match(/VILLE ([\w√Ä-√ø]+)/) || phrase.match(/√Ä ([\w√Ä-√ø]+)/) || [])[1] || "INCONNUE",
                    gamme: gammes.find(g => phrase.includes(g)) || "NON D√âTECT√âE",
                    energie: energies.find(e => phrase.includes(e)) || "√âLECTRIQUE",
                    tension: tensions.find(t => phrase.includes(t)) || "TRI",
                    ferrage: ferrages.find(f => phrase.includes(f)) || "GAUCHE",
                    niveaux: (phrase.match(/(\d+) NIVEAUX/) || [])[1] || "N/C",
                    options: optionsList.filter(o => phrase.includes(o)).join(", ") || "aucune",
                    phrase_complete: phrase
                };

                const synthesePhrase = `C'est un ${currentData.type} pour ${currentData.client}. Un ${currentData.gamme} ${currentData.niveaux} niveaux. Est-ce correct ?`;
                
                document.getElementById('previewText').innerHTML = `
                    <strong>V√©rification :</strong><br>
                    üìÑ Type : <span class="highlight">${currentData.type}</span><br>
                    üë§ Client : <span class="highlight">${currentData.client}</span><br>
                    üî• Mod√®le : <span class="highlight">${currentData.gamme} ${currentData.niveaux} niv.</span><br>
                    üõ†Ô∏è Options : <span class="highlight">${currentData.options}</span>
                `;
                document.getElementById('confirmBox').style.display = 'block';
                document.getElementById('status').innerText = "Validation vocale...";

                const utterThis = new SpeechSynthesisUtterance(synthesePhrase);
                utterThis.lang = 'fr-FR';
                synth.speak(utterThis);
            };

            document.getElementById('sendBtn').onclick = () => {
                document.getElementById('status').innerText = "Envoi en cours...";
                
                fetch(webHookUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(currentData)
                })
                .then(response => {
                    if (response.ok) {
                        alert("Donn√©es transmises !");
                        document.getElementById('confirmBox').style.display = 'none';
                        document.getElementById('status').innerText = "Pr√™t.";
                    }
                })
                .catch(err => alert("Erreur : " + err));
            };
        }
    </script>
</body>
</html>
