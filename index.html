<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UNOX Voice Assistant</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; text-align: center; padding: 20px; background: #121212; color: white; }
        .card { background: #1e1e1e; padding: 20px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); max-width: 450px; margin: auto; border: 1px solid #333; }
        #micBtn { width: 90px; height: 90px; border-radius: 50%; border: none; background: #007bff; color: white; font-size: 35px; cursor: pointer; transition: 0.3s; margin: 20px 0; }
        .recording { background: #ff4757 !important; transform: scale(1.1); box-shadow: 0 0 20px #ff4757; }
        
        /* Aide et Explications */
        #helpBtn { background: none; border: 1px solid #555; color: #aaa; padding: 5px 15px; border-radius: 20px; cursor: pointer; font-size: 13px; margin-bottom: 10px; }
        #helpContent { display: none; background: #252525; padding: 15px; border-radius: 10px; text-align: left; font-size: 13px; margin-top: 10px; color: #ddd; line-height: 1.5; }
        
        #confirmBox { display: none; margin-top: 20px; background: #2d2d2d; padding: 15px; border-radius: 12px; border: 1px dashed #555; }
        .btn-send { background: #2ed573; color: white; padding: 12px 25px; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; width: 100%; margin-top: 10px; }
        .preview { text-align: left; font-size: 14px; margin-bottom: 10px; }
        .highlight { color: #1e90ff; font-weight: bold; }
        .status { font-style: italic; color: #888; font-size: 14px; }
    </style>
</head>
<body>

    <div class="card">
        <button id="helpBtn">‚ùì Comment utiliser ?</button>
        <div id="helpContent">
            <strong>Exemple √† dire :</strong><br>
            "Fais-moi un <b>Devis</b> pour <b>Client</b> Martin √† <b>Ville</b> Lyon, four <b>Cheftop</b> <b>gaz</b> <b>10 niveaux</b> en <b>Tri</b> avec <b>ferrage √† droite</b> et option <b>lavage</b>."
            <br><br>
            <strong>Mots-cl√©s reconnus :</strong><br>
            ‚Ä¢ Type : Devis, Commande, Facture<br>
            ‚Ä¢ Gamme : Cheftop, Bakertop, Speed, etc.<br>
            ‚Ä¢ √ânergie : Gaz, √âlectrique<br>
            ‚Ä¢ Tension : Mono, Tri<br>
            ‚Ä¢ Ferrage : Gauche, Droite
        </div>

        <h2>Assistant UNOX</h2>
        <button id="micBtn">üéôÔ∏è</button>
        <div id="status" class="status">Appuyez pour dicter votre demande</div>

        <div id="confirmBox">
            <div class="preview" id="previewText"></div>
            <button class="btn-send" id="sendBtn">ENVOYER √Ä MAKE ‚úÖ</button>
        </div>
    </div>

    <script>
        const webHookUrl = "https://hook.eu2.make.com/dkhjvgph0ma9v39b9vputryap8k2yqh5"; 
        let currentData = null;

        // --- LISTES DE R√âF√âRENCE ---
        const types = ["DEVIS", "COMMANDE", "FACTURE"];
        const gammes = ["CHEFTOP", "BAKERTOP", "SPEED", "BAKERLUX", "CHEFLUX", "LINEMISS", "LINEMICRO", "EVEREO"];
        const energies = ["GAZ", "ELECTRIQUE", "√âLECTRIQUE"];
        const tensions = ["TRI", "TRIPHAS√â", "MONO", "MONOPHAS√â"];
        const ferrages = ["DROITE", "GAUCHE"];
        const optionsList = ["LAVAGE", "SONDE", "HOTTE", "OSMOSEUR"];

        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const synth = window.speechSynthesis;

        // Toggle Aide
        document.getElementById('helpBtn').onclick = () => {
            const content = document.getElementById('helpContent');
            content.style.display = content.style.display === 'block' ? 'none' : 'block';
        };

        if (SpeechRecognition) {
            const recognition = new SpeechRecognition();
            recognition.lang = 'fr-FR';

            document.getElementById('micBtn').onclick = () => {
                recognition.start();
                document.getElementById('micBtn').classList.add('recording');
                document.getElementById('status').innerText = "Je vous √©coute...";
                document.getElementById('confirmBox').style.display = 'none';
            };

            recognition.onresult = (event) => {
                const phrase = event.results[0][0].transcript.toUpperCase();
                document.getElementById('micBtn').classList.remove('recording');
                
                // Analyse intelligente
                currentData = {
                    type: types.find(t => phrase.includes(t)) || "DOCUMENT",
                    client: phrase.match(/CLIENT ([\w√Ä-√ø]+)/)?.[1] || "INCONNU",
                    ville: phrase.match(/VILLE ([\w√Ä-√ø]+)/)?.[1] || phrase.match(/√Ä ([\w√Ä-√ø]+)/)?.[1] || "INCONNUE",
                    gamme: gammes.find(g => phrase.includes(g)) || "FOUR",
                    energie: energies.find(e => phrase.includes(e)) || "√âLECTRIQUE",
                    tension: tensions.find(t => phrase.includes(t)) || "N/C",
                    ferrage: ferrages.find(f => phrase.includes(f)) || "GAUCHE",
                    niveaux: phrase.match(/(\d+) NIVEAUX/)?.[1] || "N/C",
                    options: optionsList.filter(o => phrase.includes(o)).join(", ") || "aucune",
                };

                // Synth√®se Vocale de validation
                const synthesePhrase = `Vous souhaitez un ${currentData.type} pour le client ${currentData.client} √† ${currentData.ville}. Un four ${currentData.gamme} ${currentData.niveaux} niveaux, ${currentData.energie} ${currentData.tension}, ferrage ${currentData.ferrage}. Est-ce correct ?`;
                
                document.getElementById('previewText').innerHTML = `
                    <strong>V√©rification :</strong><br>
                    üìÑ Type : <span class="highlight">${currentData.type}</span><br>
                    üë§ Client : <span class="highlight">${currentData.client}</span> (${currentData.ville})<br>
                    üî• Mod√®le : <span class="highlight">${currentData.gamme} - ${currentData.niveaux} niv.</span><br>
                    ‚ö° Config : <span class="highlight">${currentData.energie} / ${currentData.tension} / Porte ${currentData.ferrage}</span><br>
                    üõ†Ô∏è Options : <span class="highlight">${currentData.options}</span>
                `;
                document.getElementById('confirmBox').style.display = 'block';
                document.getElementById('status').innerText = "Validation vocale...";

                const utterThis = new SpeechSynthesisUtterance(synthesePhrase);
                utterThis.lang = 'fr-FR';
                synth.speak(utterThis);
            };

            document.getElementById('sendBtn').onclick = () => {
                fetch(webHookUrl, {
                    method: 'POST',
                    body: JSON.stringify(currentData),
                    headers: { 'Content-Type': 'application/json' }
                }).then(() => {
                    alert("JSON envoy√© avec succ√®s !");
                    document.getElementById('confirmBox').style.display = 'none';
                    document.getElementById('status').innerText = "Transmis.";
                }).catch(err => alert("Erreur d'envoi. V√©rifiez l'URL du Webhook."));
            };
        }
    </script>
</body>
</html>
