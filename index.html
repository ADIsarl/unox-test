<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UNOX Voice Assistant Pro</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; text-align: center; padding: 20px; background: #121212; color: white; }
        .card { background: #1e1e1e; padding: 20px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); max-width: 450px; margin: auto; border: 1px solid #333; }
        
        /* Bouton Micro */
        #micBtn { width: 90px; height: 90px; border-radius: 50%; border: none; background: #007bff; color: white; font-size: 35px; cursor: pointer; transition: 0.3s; margin: 20px 0; }
        .recording { background: #ff4757 !important; transform: scale(1.1); box-shadow: 0 0 20px #ff4757; }
        
        /* Aide d√©taill√©e (R√©tablie) */
        #helpContent { background: #252525; padding: 15px; border-radius: 10px; text-align: left; font-size: 13px; margin-top: 10px; color: #ddd; line-height: 1.5; border: 1px solid #444; }
        
        /* Zone de confirmation */
        #confirmBox { display: none; margin-top: 20px; background: #2d2d2d; padding: 15px; border-radius: 12px; border: 1px dashed #555; }
        .btn-send { background: #2ed573; color: white; padding: 12px 25px; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; width: 100%; margin-top: 10px; }
        
        .preview { text-align: left; font-size: 14px; margin-bottom: 10px; }
        .highlight { color: #1e90ff; font-weight: bold; }
        .status { font-style: italic; color: #888; font-size: 14px; margin-top: 10px; }
        h2 { margin-bottom: 5px; color: #007bff; }
    </style>
</head>
<body>

    <div class="card">
        <h2>Assistant UNOX</h2>
        <div id="status" class="status">Appuyez pour dicter</div>

        <button id="micBtn">üéôÔ∏è</button>

        <div id="helpContent">
            <strong>üí° Exemple √† prononcer :</strong><br>
            "Fais-moi un <span class="highlight">Devis</span> pour <span class="highlight">Client</span> Martin √† <span class="highlight">Ville</span> Lyon, four <span class="highlight">Cheftop</span> <span class="highlight">gaz</span> <span class="highlight">10 niveaux</span> en <span class="highlight">Tri</span> avec <span class="highlight">ferrage √† droite</span> et option <span class="highlight">lavage</span>."
            <hr style="border: 0; border-top: 1px solid #444; margin: 10px 0;">
            <strong>Mots-cl√©s reconnus :</strong><br>
            ‚Ä¢ <b>Type :</b> Devis, Commande, Facture<br>
            ‚Ä¢ <b>Gamme :</b> Cheftop, Bakertop, Speed, Bakerlux, Cheflux, Linemiss, Linemicro, Evereo<br>
            ‚Ä¢ <b>√ânergie :</b> Gaz, √âlectrique<br>
            ‚Ä¢ <b>Tension :</b> Mono, Tri<br>
            ‚Ä¢ <b>Ferrage :</b> Gauche, Droite
        </div>

        <div id="confirmBox">
            <div class="preview" id="previewText"></div>
            <button class="btn-send" id="sendBtn">VALIDER ET ENVOYER ‚úÖ</button>
            <p style="font-size: 11px; color: #888;">Si erreur, r√©-appuyez sur le micro pour corriger.</p>
        </div>
    </div>

    <script>
        const webHookUrl = "https://hook.eu2.make.com/dkhjvgph0ma9v39b9vputryap8k2yqh5"; 
        let currentData = null;

        const types = ["DEVIS", "COMMANDE", "FACTURE"];
        const gammes = ["CHEFTOP", "BAKERTOP", "SPEED", "BAKERLUX", "CHEFLUX", "LINEMISS", "LINEMICRO", "EVEREO"];
        const energies = ["GAZ", "ELECTRIQUE", "√âLECTRIQUE"];
        const tensions = ["TRI", "TRIPHAS√â", "MONO", "MONOPHAS√â"];
        const ferrages = ["DROITE", "GAUCHE"];
        const optionsList = ["LAVAGE", "SONDE", "HOTTE", "OSMOSEUR"];

        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const synth = window.speechSynthesis;

        if (SpeechRecognition) {
            const recognition = new SpeechRecognition();
            recognition.lang = 'fr-FR';

            document.getElementById('micBtn').onclick = () => {
                recognition.start();
                document.getElementById('micBtn').classList.add('recording');
                document.getElementById('status').innerText = "√âcoute en cours...";
                document.getElementById('confirmBox').style.display = 'none';
            };

            recognition.onresult = (event) => {
                const phrase = event.results[0][0].transcript.toUpperCase();
                document.getElementById('micBtn').classList.remove('recording');
                
                // Analyse et extraction des points cl√©s
                currentData = {
                    type: types.find(t => phrase.includes(t)) || "DEVIS",
                    client: (phrase.match(/CLIENT ([\w√Ä-√ø]+)/) || [])[1] || "NON PR√âCIS√â",
                    ville: (phrase.match(/VILLE ([\w√Ä-√ø]+)/) || phrase.match(/√Ä ([\w√Ä-√ø]+)/) || [])[1] || "NON PR√âCIS√âE",
                    gamme: gammes.find(g => phrase.includes(g)) || "NON D√âTECT√âE",
                    energie: energies.find(e => phrase.includes(e)) || "√âLECTRIQUE",
                    tension: tensions.find(t => phrase.includes(t)) || "TRI",
                    ferrage: ferrages.find(f => phrase.includes(f)) || "GAUCHE",
                    niveaux: (phrase.match(/(\d+) NIVEAUX/) || [])[1] || "N/C",
                    options: optionsList.filter(o => phrase.includes(o)).join(", ") || "aucune",
                    phrase_source: phrase
                };

                // Synth√®se Vocale
                const synthesePhrase = `Vous voulez un ${currentData.type} pour ${currentData.client}. Un ${currentData.gamme} ${currentData.niveaux} niveaux en ${currentData.energie} ${currentData.tension}. C'est bien √ßa ?`;
                
                document.getElementById('previewText').innerHTML = `
                    <strong>R√©capitulatif √† envoyer :</strong><br>
                    üìÑ Type : <span class="highlight">${currentData.type}</span><br>
                    üë§ Client : <span class="highlight">${currentData.client}</span> (${currentData.ville})<br>
                    üî• Mod√®le : <span class="highlight">${currentData.gamme} - ${currentData.niveaux} niv.</span><br>
                    ‚ö° Config : <span class="highlight">${currentData.energie} / ${currentData.tension}</span><br>
                    üö™ Porte : <span class="highlight">${currentData.ferrage}</span><br>
                    üõ†Ô∏è Options : <span class="highlight">${currentData.options}</span>
                `;
                document.getElementById('confirmBox').style.display = 'block';
                document.getElementById('status').innerText = "V√©rification vocale...";

                const utterThis = new SpeechSynthesisUtterance(synthesePhrase);
                utterThis.lang = 'fr-FR';
                synth.speak(utterThis);
            };

            document.getElementById('sendBtn').onclick = () => {
                document.getElementById('status').innerText = "Envoi √† Make...";
                
                fetch(webHookUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(currentData)
                })
                .then(response => {
                    if (response.ok) {
                        alert("Donn√©es transmises avec succ√®s !");
                        document.getElementById('confirmBox').style.display = 'none';
                        document.getElementById('status').innerText = "Pr√™t pour une nouvelle saisie.";
                    }
                })
                .catch(err => alert("Erreur lors de l'envoi : " + err));
            };
        }
    </script>
</body>
</html>
