<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UNOX Voice Assistant</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; text-align: center; padding: 20px; background: #1a1a1a; color: white; }
        .card { background: #2d2d2d; padding: 20px; border-radius: 15px; max-width: 500px; margin: auto; }
        #micBtn { width: 100px; height: 100px; border-radius: 50%; border: none; background: #007bff; color: white; font-size: 40px; cursor: pointer; }
        .recording { background: #dc3545 !important; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.7); } 70% { box-shadow: 0 0 0 15px rgba(220, 53, 69, 0); } 100% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0); } }
        #confirmBox { display: none; margin-top: 20px; border-top: 1px solid #444; padding-top: 20px; }
        .btn-send { background: #28a745; color: white; padding: 15px 30px; border: none; border-radius: 8px; font-size: 18px; cursor: pointer; }
        .preview { text-align: left; background: #3d3d3d; padding: 15px; border-radius: 8px; margin: 15px 0; font-size: 14px; }
        .highlight { color: #00d1b2; font-weight: bold; }
    </style>
</head>
<body>

    <div class="card">
        <h2>Assistant UNOX</h2>
        <button id="micBtn">üéôÔ∏è</button>
        <div id="status" style="margin: 15px 0; font-style: italic; color: #aaa;">Appuyez pour dicter</div>

        <div id="confirmBox">
            <div class="preview" id="previewText"></div>
            <button class="btn-send" id="sendBtn">‚úÖ CONFIRMER ET ENVOYER</button>
            <p style="font-size: 12px; color: #888; margin-top: 10px;">Ou r√©-appuyez sur le micro pour recommencer</p>
        </div>
    </div>

    <script>
        const webHookUrl = "VOTRE_URL_MAKE_ICI"; 
        let currentData = null;

        const types = ["DEVIS", "COMMANDE", "FACTURE"];
        const gammes = ["CHEFTOP", "BAKERTOP", "SPEED", "BAKERLUX", "CHEFLUX", "LINEMISS", "LINEMICRO", "EVEREO"];
        const energies = ["GAZ", "ELECTRIQUE", "√âLECTRIQUE"];
        const tensions = ["TRI", "TRIPHAS√â", "MONO", "MONOPHAS√â"];
        const ferrages = ["DROITE", "GAUCHE"];
        const optionsList = ["LAVAGE", "SONDE", "HOTTE", "OSMOSEUR"];

        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        const synth = window.speechSynthesis;

        if (SpeechRecognition) {
            const recognition = new SpeechRecognition();
            recognition.lang = 'fr-FR';

            document.getElementById('micBtn').onclick = () => {
                recognition.start();
                document.getElementById('micBtn').classList.add('recording');
                document.getElementById('status').innerText = "Je vous √©coute...";
                document.getElementById('confirmBox').style.display = 'none';
            };

            recognition.onresult = (event) => {
                const phrase = event.results[0][0].transcript.toUpperCase();
                document.getElementById('micBtn').classList.remove('recording');
                
                // Analyse des mots-cl√©s
                currentData = {
                    type: types.find(t => phrase.includes(t)) || "DOCUMENT",
                    client: phrase.match(/CLIENT ([\w√Ä-√ø]+)/)?.[1] || "INCONNU",
                    ville: phrase.match(/VILLE ([\w√Ä-√ø]+)/)?.[1] || "INCONNUE",
                    gamme: gammes.find(g => phrase.includes(g)) || "FOUR",
                    energie: energies.find(e => phrase.includes(e)) || "",
                    tension: tensions.find(t => phrase.includes(t)) || "",
                    ferrage: ferrages.find(f => phrase.includes(f)) || "GAUCHE",
                    niveaux: phrase.match(/(\d+) NIVEAUX/)?.[1] || "",
                    options: optionsList.filter(o => phrase.includes(o)).join(", ") || "aucune",
                };

                // Pr√©paration de la phrase de r√©p√©tition
                const synthesePhrase = `Vous souhaitez un ${currentData.type} pour le client ${currentData.client} √† ${currentData.ville}. Un four ${currentData.gamme} ${currentData.niveaux} niveaux, ${currentData.energie} ${currentData.tension}, ferrage ${currentData.ferrage}, avec les options suivantes : ${currentData.options}. Est-ce correct ?`;
                
                // Affichage visuel
                document.getElementById('previewText').innerHTML = `
                    <strong>R√©capitulatif :</strong><br>
                    ${currentData.type} - Client: <span class="highlight">${currentData.client}</span> (${currentData.ville})<br>
                    Mod√®le: <span class="highlight">${currentData.gamme} ${currentData.niveaux} niv.</span><br>
                    Config: <span class="highlight">${currentData.energie} / ${currentData.tension} / Porte ${currentData.ferrage}</span><br>
                    Options: <span class="highlight">${currentData.options}</span>
                `;
                document.getElementById('confirmBox').style.display = 'block';
                document.getElementById('status').innerText = "V√©rification en cours...";

                // Lecture vocale
                const utterThis = new SpeechSynthesisUtterance(synthesePhrase);
                utterThis.lang = 'fr-FR';
                synth.speak(utterThis);
            };

            document.getElementById('sendBtn').onclick = () => {
                fetch(webHookUrl, {
                    method: 'POST',
                    body: JSON.stringify(currentData),
                    headers: { 'Content-Type': 'application/json' }
                }).then(() => {
                    alert("Envoy√© √† Make avec succ√®s !");
                    document.getElementById('confirmBox').style.display = 'none';
                    document.getElementById('status').innerText = "Appuyez pour une nouvelle saisie";
                });
            };
        }
    </script>
</body>
</html>
